#!/bin/bash

set -e  # Шоттс: "Безопасный режим. При ошибке — стоп."
        # Бодрийяр: "Ошибка — момент истины. Но пусть она наступит в нужный момент."

echo "Переход между ветками"
echo "Команда git switch"

WORKDIR="git-switch-example"

if command -v git > /dev/null 2>&1; then
  # Шоттс: "Проверка наличия git."
  # Бодрийяр: "Без инструмента — нет игры. Без зеркала — нет отражения."

  echo "Git версии $(git --version) установлен."
  # Шоттс: "Версия подтверждена, продолжаем."
  # Бодрийяр: "Версия — иллюзия прогресса. Но мы согласны играть по правилам."

  mkdir -p "$WORKDIR"
  cd "$WORKDIR" || { echo "Невозможно перейти в каталог"; exit 1;}
  # Шоттс: "Создаём каталог для эксперимента."
  # Бодрийяр: "Каждая папка — маленький симулякр пространства."

  git init --quiet --initial-branch=main
  # Шоттс: "Инициализация репозитория, ветка main."
  # Бодрийяр: "Main — миф об изначальном. Псевдо-основа любой симуляции."

  git branch
  # Шоттс: "Пока есть только main."
  # Бодрийяр: "Но даже одна ветка уже намекает на множественность."

  echo "Hello, World!" > file.txt
  git add file.txt
  git commit -m "added file.txt"
  # Шоттс: "Первый коммит, создаём фундамент."
  # Бодрийяр: "Символический акт сотворения. Genesis.txt."

  git branch
  # Шоттс: "Убеждаемся, что всё ещё на main."
  # Бодрийяр: "Иллюзия стабильности перед раздвоением."

  git switch -c side
  # Шоттс: "Создаём новую ветку side и переходим на неё."
  # Бодрийяр: "Распад начинается. Размножение Я. Расщепление на 'основное' и 'побочное'."

  git branch
  # Шоттс: "Теперь две ветки."
  # Бодрийяр: "Два пути, два отражения. Ни один не истинный."


  echo "$(whoami)" > file2.md
  git add file2.md
  git commit -m "added file2.md on branch 'side'"
  # Шоттс: "Добавляем артефакт во вторую ветку."
  # Бодрийяр: "След субъекта. Самость как метка во множественной реальности."

  git branch
  # Шоттс: "Снова проверка веток."
  # Бодрийяр: "Никакая ветка не главная. Они равны в поле симуляции."

  git switch main
  # Шоттс: "Возвращаемся на main."
  # Бодрийяр: "Возвращение в якобы-оригинал. Но он уже заражён знанием о копии."

  git branch
  # Шоттс: "Смотрим, на какой ветке мы теперь."
  # Бодрийяр: "Ты думаешь, что вернулся. Но ты стал другим, даже если файл тот же."

  git log --oneline
  # Шоттс: "Просматриваем историю."
  # Бодрийяр: "История как архив симулякров. Никаких фактов — только следы актов."
else 
  echo "Установите git"
  # Шоттс: "Без git не начнём."
  # Бодрийяр: "Без зеркала субъект не способен на рефлексию."
fi

